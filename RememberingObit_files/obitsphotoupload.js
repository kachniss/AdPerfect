var mod_obitsphotoupload={uploaders:mod.obitsphotoupload.uploaders,photo_errors:{max_photo_error:"Maximum allowed photos error.",min_photo_error:"Minimum required photos error.",photo_type_error:"Invalid file type.",photo_delete_error:"Photo delete error.",invalid_request:"Invalid photo request.",photo_file_too_big:"Photo size is bigger ({{filesize}}MB) than max size ({{maxFilesize}}MB).",photo_response_error:"Server response error with code {{statusCode}}."},init:function(){if(typeof mod.obitsphotoupload.photo_errors!=="undefined"){$.each(mod.obitsphotoupload.photo_errors,function(a,b){if(b){mod_obitsphotoupload.photo_errors[a]=b;}});}$.each(mod_obitsphotoupload.uploaders,function(b,a){if(!a.initialize){return;}mod_obitsphotoupload.initialize_uploader(b);});},init_fileupload:function(b,a){$("#"+b).fileupload({forceIframeTransport:true,autoUpload:false,dataType:"text",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,maxFileSize:a.max_file_size,progressInterval:10,progress:function(f,d){var c=parseInt(d.loaded/d.total*100,10);mod_obitsphotoupload.update_fileupload_progress(b,c);},add:function(c,d){if(typeof mod_obitsphotoupload.uploaders[b].accept==="function"){if(mod_obitsphotoupload.uploaders[b].accept(d)){mod_obitsphotoupload.update_fileupload_progress(b,0);d.submit();}else{mod_obitsphotoupload.handle_error(b,{message:mod_obitsphotoupload.uploaders[b].accept_msg,id:b});}}else{mod_obitsphotoupload.update_fileupload_progress(b,0);d.submit();}},done:function(d,c){mod_obitsphotoupload.update_fileupload_progress(b,100);if(typeof mod_obitsphotoupload.uploaders[b].success==="function"){mod_obitsphotoupload.uploaders[b].success(c.result);}},always:function(d,c){if(typeof mod_obitsphotoupload.uploaders[b].complete==="function"){mod_obitsphotoupload.uploaders[b].complete(c);}mod_obitsphotoupload.clear_fileupload_progress(b);}});},init_dropzone:function(c,a){var b=mod_obitsphotoupload.camelize(c);Dropzone.options[b]={parallelUploads:1,dictDefaultMessage:a.default_message,addRemoveLinks:false,createImageThumbnails:true,acceptedFiles:a.acceptFiles.join(),maxFilesize:a.max_file_size/1024/1024,maxFiles:a.max_files,dictMaxFilesExceeded:mod_obitsphotoupload.photo_errors.max_photo_error,dictFileTooBig:mod_obitsphotoupload.photo_errors.photo_file_too_big,dictResponseError:mod_obitsphotoupload.photo_errors.photo_response_error,dictInvalidFileType:mod_obitsphotoupload.photo_errors.photo_type_error,accept:function(e,d){if(typeof mod_obitsphotoupload.uploaders[c].accept==="function"){if(mod_obitsphotoupload.uploaders[c].accept(e)){d();}else{d(mod_obitsphotoupload.uploaders[c].accept_msg);}}else{if(e.name.indexOf("'")>=0){mod_obitsphotoupload.handle_error(c,{file:e,message:i18n.T("invalid_uploaded_file_name"),id:c});return;}else{d();}}},init:function(){this.on("error",function(d,e){mod_obitsphotoupload.handle_error(c,{file:d,message:e,id:c});}).on("success",function(d,e){if(typeof mod_obitsphotoupload.uploaders[c].success==="function"){mod_obitsphotoupload.uploaders[c].success(e);}}).on("complete",function(e){var d=mod_obitsphotoupload.uploaders[c];if(typeof d.complete==="function"){if(d.should_remove){this.removeFile(e);}mod_obitsphotoupload.uploaders[c].complete(e);}else{this.removeFile(e);}});}};},camelize:function(a){return a.replace(/[\-_](\w)/g,function(b){return b[1].toUpperCase();});},handle_error:function(b,a){if(typeof mod_obitsphotoupload.uploaders[b].error==="function"){mod_obitsphotoupload.uploaders[b].error(a);}},update_fileupload_progress:function(c,b){var a=$("#"+c+"-progress");if(!a.hasClass("uploading")){a.addClass("uploading");}a.find("#"+c+"-progress-bar").css("width",b+"%");a.find("#"+c+"-progress-percent").html(b+"%");},clear_fileupload_progress:function(b){var a=$("#"+b+"-progress");a.removeClass("uploading");a.find("#"+b+"-progress-bar").css("width",0+"%");a.find("#"+b+"-progress-percent").html("");},set_accept:function(c,a,b){if(!mod_obitsphotoupload.uploaders[c]){return;}b=b||"File is not accepted";mod_obitsphotoupload.uploaders[c].accept=a;mod_obitsphotoupload.uploaders[c].accept_msg=b;},set_error:function(b,a){if(!mod_obitsphotoupload.uploaders[b]){return;}mod_obitsphotoupload.uploaders[b].error=a;},set_success:function(b,a){if(!mod_obitsphotoupload.uploaders[b]){return;}mod_obitsphotoupload.uploaders[b].success=a;},set_complete:function(c,a,b){if(!mod_obitsphotoupload.uploaders[c]){return;}b=b||true;mod_obitsphotoupload.uploaders[c].complete=a;mod_obitsphotoupload.uploaders[c].should_remove=b;},initialize_uploader:function(b){if(!mod_obitsphotoupload.uploaders[b]||$("#"+b).length===0){return;}var a=mod_obitsphotoupload.uploaders[b];if(mod_obitsphotoupload.is_dropzonable(b)){mod_obitsphotoupload.init_dropzone(b,a);}else{mod_obitsphotoupload.init_fileupload(b,a);}},is_dropzonable:function(a){return $("#"+a).hasClass("dropzone");}};$(function(){mod_obitsphotoupload.init();});