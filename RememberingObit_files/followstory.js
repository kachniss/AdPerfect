var mod_followstory={email_container:null,email_input:null,email_error_container:null,follow_success_container:null,unfollow_success_container:null,action_elements:null,init:function(){mod_followstory.email_container=$(".ap-follow-story-email-container");mod_followstory.email_input=$(".ap-follow-story-email");mod_followstory.email_error_container=$(".ap-follow-story-email-error");mod_followstory.follow_success_container=$(".ap-follow-story-success-container");mod_followstory.unfollow_success_container=$(".ap-unfollow-story-success-container");mod_followstory.action_elements=$(".ap-follow-story-action");if(parseInt(mod.followstory.append)){$("body").append(mod_followstory.email_container);$("body").append(mod_followstory.follow_success_container);$("body").append(mod_followstory.unfollow_success_container);}mod_followstory.handle_follow_story_success();},register_handler:function(){$(".ap-follow-story-follow").on("click",mod_followstory.handle_follow_story);$(".ap-follow-story-unfollow").on("click",mod_followstory.handle_unfollow_story);$(".ap-follow-story-submit").on("click",mod_followstory.handle_submit_follow);mod_followstory.email_input.keydown(function(a){if(a.keyCode==13){mod_followstory.handle_submit_follow(a);}});},handle_follow_story_success:function(){if(typeof mod.followstory.follow_story_success!=="undefined"&&mod.followstory.follow_story_success){if(mod.followstory.follow_story_success==="follow"){mod_followstory.show_follow_success_section();}else{mod_followstory.show_unfollow_success_section();}}},handle_follow_story:function(a){a.preventDefault();if(mod_followstory.email_container.length){mod_followstory.show_email_section();}else{mod_followstory.process_follow_story("follow-story",mod_followstory.show_system_msg_error);}},handle_submit_follow:function(a){a.preventDefault();mod_followstory.process_follow_story("follow-story",mod_followstory.show_container_error);},handle_unfollow_story:function(a){a.preventDefault();mod_followstory.process_follow_story("unfollow-story",mod_followstory.show_system_msg_error);},process_follow_story:function(d,b){var a=mod_followstory.email_input.val();var c={mod_followstory:"",story_id:mod.followstory.story_id,redirect_url:mod.followstory.redirect_url,page_type:wp.pagetype,action_type:d,follower_email:a};mod_followstory.disable_action_elements();mod_followstory.hide_container_error();return $.ajaxQueue({dataType:"json",url:"/ajax/post_form/",data:c,type:"POST",success:function(e){if(e===null){return;}if(e.type==="ap_success"){mod_followstory.process_follow_story_result(e);}else{mod_followstory.enable_action_elements();if(typeof b==="function"){b(e.message);}}}});},process_follow_story_result:function(a){if(typeof a.message!=="undefined"&&typeof a.message.redirect_key!=="undefined"){location.href="/follow-obituary/"+a.message.redirect_key;}else{mod_followstory.enable_action_elements();}},show_follow_success_section:function(){mod_followstory.follow_success_container.show();},show_unfollow_success_section:function(){mod_followstory.unfollow_success_container.show();},show_email_section:function(){mod_followstory.email_container.show();},show_system_msg_error:function(a){if(typeof mod_system_message!=="undefined"&&mod.system_message.centralized_system_msg==1){mod_system_message.display_message(a,"error");}else{alert(a);}},show_container_error:function(a){mod_followstory.email_error_container.html(a).show();},hide_container_error:function(){mod_followstory.email_error_container.hide();},disable_action_elements:function(){mod_followstory.action_elements.addClass("disabled");},enable_action_elements:function(){mod_followstory.action_elements.removeClass("disabled");}};$(document).ready(function(){mod_followstory.init();mod_followstory.register_handler();});