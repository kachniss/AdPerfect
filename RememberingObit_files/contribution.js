mod_contribution={container:$(null),flagged:false,pagination_ajax:null,init:function(){mod_contribution.container=$("#ap-contribution-container");mod_contribution.inject_contribution_container_overlay();},get_photo_gallery_overlay:function(){return $("#ap-photodisplay-photo-overlay");},register_handlers:function(){mod_contribution.container.on("click",".ap-contribution-content-action-container",mod_contribution.handle_content_action_click).on("click",".ap_page_link a",mod_contribution.handle_pagination);mod_contribution.container.on("click",".ap-contribution-photo-item",mod_contribution.overlay_on);mod_contribution.get_photo_gallery_overlay().on("click",".ap-detail-overlay-closebtn",mod_contribution.overlay_off);if(typeof mod_paginator!=="undefined"){mod_paginator.set_dynamic_change_handler(mod_contribution.container,mod_contribution.handle_dropdown_pagination);}},overlay_on:function(){if(mod_contribution.flagged===false){var a=$(this).attr("data-id");var c=$(this).attr("data-thumbnail");var b={action_type:"get_contribution_photo",contribution_id:a,photo_clicked:c,story_id:mod.contribution.story_id};mod_contribution.submit_ajax(b,mod_contribution.build_photo_overlay);mod_contribution.flagged=true;}},overlay_off:function(){mod_contribution.get_photo_gallery_overlay().hide().empty().append($('<a href="javascript:void(0)" class="ap-detail-overlay-closebtn">&times;</a>'));mod_contribution.flagged=false;},build_photo_overlay:function(b){var g=b.message.photo_clicked;var h=b.message.photo_source;var a=h.indexOf(g);var e="";$.each(h,function(i,j){e+='<li><a href="#"><img src="'+j+'" class="ap-image-thumbnail img-responsive"/></a></li>';});var d=$('<div id="ap-contribution-photoslider" class="flexslider"></div>');var f=$('<div id="ap-contribution-photocarousel" class="flexslider"></div>');var c='<ul class="slides">'+e+"</ul>";d.append(c).appendTo(mod_contribution.get_photo_gallery_overlay());f.append(c).appendTo(mod_contribution.get_photo_gallery_overlay());if(h.length===1){f.hide();}mod_contribution.get_photo_gallery_overlay().show();mod_contribution.activate_flexslider(a);},activate_flexslider:function(a){var b=$("#ap-contribution-photocarousel li");var c=$(b[a]);$("#ap-contribution-photocarousel").flexslider({controlNav:false,slideshow:false,itemWidth:210,itemMargin:5,asNavFor:"#ap-contribution-photoslider",start:function(){b.removeClass("flex-active-slide");c.addClass("flex-active-slide");}});$("#ap-contribution-photoslider").flexslider({animation:"slide",controlNav:false,slideshow:false,startAt:a});$("#ap-contribution-photocarousel ul.slides").css("width","100%");$("#ap-contribution-photocarousel >.flex-viewport").css("height","115px");$("#ap-contribution-photocarousel .slides li").css("margin-right",0);$("#ap-contribution-photoslider").imagesLoaded().done(function(){var d=-1;$("#ap-contribution-photoslider img.ap-image-thumbnail").each(function(){var f=$(this);var e=f[0]["height"];d=e>d?e:d;});$("#ap-contribution-photoslider img.ap-image-thumbnail").each(function(){var f=$(this);var e=f[0]["height"];if(e<=d){f.closest("#ap-contribution-photoslider ul.slides").css("display","flex");f.closest("li").addClass("ap-centering-image");}});});},handle_content_action_click:function(b){var a=$(b.target);if(a.hasClass("ap-contribution-content-show-more")){b.preventDefault();mod_contribution.show_more(a);}else{if(a.hasClass("ap-contribution-content-show-less")){b.preventDefault();mod_contribution.show_less(a);}}},show_more:function(b){var a=$(b).closest(".ap-contribution-content");a.find(".ap-contribution-full-content").show();a.find(".ap-contribution-trimmed-content").hide();a.find(".ap-contribution-content-show-less").show();$(b).hide();},show_less:function(b){var a=$(b).closest(".ap-contribution-content");a.find(".ap-contribution-full-content").hide();a.find(".ap-contribution-trimmed-content").show();a.find(".ap-contribution-content-show-more").show();$(b).hide();},handle_dropdown_pagination:function(){mod_contribution.update_display({page:$(this).val()});},handle_pagination:function(b){b.preventDefault();var a=$(this).attr("data-page");mod_contribution.update_display({page:a});},update_display:function(a){if(mod_contribution.pagination_ajax!==null&&typeof mod_contribution.pagination_ajax.abort==="function"){mod_contribution.pagination_ajax.abort();}var b={action_type:"update_display",limit:mod.contribution.page_size,story_id:mod.contribution.story_id,page_type:wp.pagetype,include_owner_contribution:mod.contribution.include_owner_contribution};mod_contribution.show_contribution_container_overlay();mod_contribution.pagination_ajax=mod_contribution.submit_ajax($.extend(b,a),mod_contribution.handle_update_display_response,mod_contribution.hide_contribution_container_overlay);},handle_update_display_response:function(a){if(a&&a.message){var c=$(a.message).html();mod_contribution.container.html(c);var b=mod_contribution.container.find("select");if(typeof b.selectpicker==="function"){b.selectpicker("refresh");}scroll_to_element(mod_contribution.container);mod_contribution.inject_contribution_container_overlay();}},submit_ajax:function(b,d,a){var c={mod_contribution:""};$.extend(c,b);return $.ajax({dataType:"json",url:"/ajax/post_form/",data:c,type:"POST",success:function(e){if(e!==null){if(typeof d==="function"){d(e);}}},complete:function(){if(typeof a==="function"){a();}}});},inject_contribution_container_overlay:function(){mod_contribution.container.find("#ap-contribution-items-container").prepend($('<div class="ap-contribution-overlay"/>'));},show_contribution_container_overlay:function(){mod_contribution.container.find(".ap-contribution-overlay").addClass("active");},hide_contribution_container_overlay:function(){mod_contribution.container.find(".ap-contribution-overlay").removeClass("active");}};$(document).ready(function(){mod_contribution.init();mod_contribution.register_handlers();});