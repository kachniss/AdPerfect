var ap_isu={tmp_values:{},curr_values:{},update_callbacks:{},init:function(){ap_isu.init_popup();ap_isu.init_default_values();},init_default_values:function(){for(var a in mod.ap_isu.init){ap_isu.curr_values[a]=mod.ap_isu.init[a];}ap_isu.curr_values.loc_str=$("#ap_isu_loc").val();},register_callback:function(a,b){ap_isu.update_callbacks[a]=b;},update_modules:function(a){for(var c in ap_isu.update_callbacks){if(c==a){continue;}ap_isu.update_callbacks[c](ap_isu.tmp_values);}for(var b in ap_isu.tmp_values){ap_isu.curr_values[b]=ap_isu.tmp_values[b];delete ap_isu.tmp_values[b];}},set_tmp_item:function(a,b){ap_isu.tmp_values[a]=b;},init_popup:function(){var a=$("#ap_isu_popup_wrap");if(a.length==0){return;}var b={};b[mod.ap_isu.popup.submitbutton]=ap_isu.submit_area_popup;b[mod.ap_isu.popup.cancelbutton]=function(){$(this).dialog("close");};$("#ap_isu_popup_wrap").dialog({height:"auto",width:"auto",modal:true,autoOpen:false,draggable:false,resizable:false,title:mod.ap_isu.popup.titletext,buttons:b,open:function(){var c=$("#ap_isu_loc").get(0);if(c){c.focus();c.setSelectionRange(0,999);}},beforeClose:function(){$("#ap_isu_loc").autocomplete("close");}});$("#ap_isu_loc").autocomplete({source:ap_isu.autocomplete_search,delay:mod.ap_isu.ac_delay,minLength:0,scroll:true,autoFocus:false,highlight:true,search:function(d,c){if(d.target.value.length<mod.ap_isu.ac_chars){return false;}},select:function(d,c){ap_isu.set_tmp_item("city_id",c.item.id);ap_isu.set_tmp_item("loc_str",c.item.label);},close:function(){if(ap_isu.tmp_values.loc_str){$(this).val(ap_isu.tmp_values.loc_str);}}});$("#ap_isu_loc").keypress(function(c){if(c.which==13){$("#ap_isu_popup_wrap").parent().next().find("a:eq(0)").focus();return false;}});},autocomplete_search:function(b,a){var c={term:b.term,country_code:$("#ap_isu_cc").val()};$.get("/ajax/get_location_autocomplete_v2/",c,function(d){if(d.length>0){ap_isu.set_tmp_item("city_id",d[0].id);ap_isu.set_tmp_item("loc_str",d[0].label);}a($.map(d,function(e){return{label:e.label,value:e.label,id:e.id};}));},"json");},show_area_popup:function(){$("#ap_isu_loc").val(ap_isu.curr_values.loc_str);$("#ap_isu_popup_wrap").dialog("open");},submit_area_popup:function(){var a={};var b=$("#ap_isu_dist").val();if(b==0){a.max_distance="_noval";}else{a.max_distance=b;}a.location_id=ap_isu.tmp_values.city_id;$.get("/ajax/set_area/",a,function(c){if(c.success==1){ap_isu.update_distance(b);}else{message(c.message);}},"json");$("#ap_isu_popup_wrap").dialog("close");},update_terms:function(a,b){if(!a&&a!=""){return;}ap_isu.set_tmp_item("terms",a);ap_isu.update_modules(b);ap_isu.eval_on_update(mod.ap_isu.terms.onupdate);},update_distance:function(b,c){b=parseInt(b);if(b<0){return;}ap_isu.set_tmp_item("dist",b);if(b==0){ap_isu.set_tmp_item("dist_str",mod.ap_isu.popup.unlimitedtext);}else{var a="+"+b;if(mod.ap_isu.use_metric){a+=" KMs";}else{a+=" Miles";}ap_isu.set_tmp_item("dist_str",a);}ap_isu.update_modules(c);ap_isu.eval_on_update(mod.ap_isu.area.onupdate);},eval_on_update:function(a){if(a=="none"){return;}if(a=="search"||a=="both"){var b=ap_isu.curr_values.terms;if(typeof b!="undefined"&&b!=""){return ap_isu.apply_search();}}if(a=="reload"||a=="both"){window.location.reload();}},apply_search:function(){var d="";if(typeof mod.slod==="undefined"&&typeof mod.slod.search_type==="undefined"){d="list";}else{d=mod.slod.search_type;}var a="";if(typeof ap_isu.curr_values.terms!="undefined"){a=ap_isu.curr_values.terms;}var c={search_type:"advanced",ap_search_keyword:a};var b="/"+ap_isu.curr_values.region_slug;b+="/"+ap_isu.curr_values.category_slug;if(d==="map"){b+="/map-search";}else{if(d==="multisearch"){b="/results"+compile_search(c);}else{if(ap_isu.curr_values.page_type=="summary-map"){b+="/map-search";}else{b+="/search";}b+=compile_search(c);}}if(mod.slod.search_url){b=mod.slod.search_url+b;}window.location.href=b;}};$(ap_isu.init);